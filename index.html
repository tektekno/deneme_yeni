
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duraklara Göre Sıralama</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kode+Mono:wght@400..700&family=Madimi+One&display=swap');
    
        body {
            font-family: 'Kode Mono', monospace;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #000;
            animation: spin 1s ease infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen text-gray-800">

    <div class="container mx-auto p-4 flex-grow flex flex-col items-center justify-center">
        <div class="w-full max-w-4xl bg-white shadow-xl rounded-lg p-6">
            <div id="loading" class="flex flex-col items-center justify-center h-40">
                <div class="spinner"></div>
                <p class="mt-4 text-lg text-gray-600">Veriler yükleniyor...</p>
            </div>
            <div id="content" class="hidden">
                <div id="updatetime" class="text-right text-sm text-gray-500 mb-4"></div>
                <div id="duraklar-container" class="grid md:grid-cols-3 gap-6">
                    <!-- Durak bilgileri buraya JavaScript ile eklenecek -->
                </div>

                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h2 class="text-2xl font-bold mb-4 text-center text-madimi">KM Raporu</h2>
                    <div id="km-report-container" class="space-y-2 text-sm">
                        <!-- KM raporu buraya JavaScript ile eklenecek -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="p-4 text-center text-gray-500 text-sm">
        Tüm Hakları Saklıdır © 2024
    </footer>

    <script>
        // API'nizin adresi
        const API_URL = 'http://35.239.233.184:80/api/data';
        
        // Elemanları seç
        const loadingElement = document.getElementById('loading');
        const contentElement = document.getElementById('content');
        const duraklarContainer = document.getElementById('duraklar-container');
        const kmReportContainer = document.getElementById('km-report-container');
        const updateTimeElement = document.getElementById('updatetime');

        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error(`HTTP Hata! durum: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('API verisi alınırken bir hata oluştu:', error);
                return null;
            }
        }

        function renderData(data) {
            // Yükleme ekranını gizle, içeriği göster
            loadingElement.classList.add('hidden');
            contentElement.classList.remove('hidden');

            // Güncelleme zamanını ayarla
            updateTimeElement.textContent = `Son Güncelleme: ${data.update_time}`;

            // Durak bilgilerini işle
            duraklarContainer.innerHTML = '';
            data.duraklar.forEach(durak => {
                const durakDiv = document.createElement('div');
                durakDiv.className = 'bg-gray-50 p-4 rounded-lg shadow-inner border border-gray-200';
                
                let araclarList = '';
                if (durak.araclar.length > 0) {
                    araclarList = durak.araclar.map((arac, index) => 
                        `<p class="text-sm border-b border-gray-200 py-1 last:border-b-0">${index + 1}) <strong>${arac.kod}</strong> | ${arac.plaka} | ${arac.sure} dk</p>`
                    ).join('');
                } else {
                    araclarList = '<p class="text-sm text-center text-gray-500 mt-4">Boş</p>';
                }

                durakDiv.innerHTML = `
                    <h3 class="text-xl font-semibold mb-2 text-madimi">${durak.ad} (${durak.arac_sayisi})</h3>
                    <p class="text-xs text-gray-600 mb-4">Ortalama Kalkış: <span class="font-bold">${durak.ortalama_kalkis} dk</span></p>
                    <div class="mt-2 text-gray-700 space-y-1">
                        ${araclarList}
                    </div>
                `;
                duraklarContainer.appendChild(durakDiv);
            });

            // KM raporunu işle
            kmReportContainer.innerHTML = '';
            data.km_report.forEach(arac => {
                const kmDiv = document.createElement('div');
                kmDiv.className = 'flex items-center justify-between p-2 rounded-md bg-white border border-gray-200';
                kmDiv.innerHTML = `
                    <span class="font-semibold">${arac.kod} | ${arac.plaka}</span>
                    <span class="text-xs text-gray-600">Toplam KM: <span class="font-bold text-base">${arac.total_km_24}</span></span>
                `;
                kmReportContainer.appendChild(kmDiv);
            });
        }

        async function init() {
            const data = await fetchData();
            if (data) {
                renderData(data);
            } else {
                loadingElement.innerHTML = '<p class="text-red-500 text-lg">Veri alınamadı. Lütfen API sunucusunun çalıştığından emin olun.</p>';
            }
        }
        
        // Sayfa yüklendiğinde veriyi çek
        window.onload = init;
        
        // Her 10 saniyede bir veriyi yenile
        setInterval(init, 10000);

    </script>
</body>
</html>
