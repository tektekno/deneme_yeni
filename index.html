<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duraklara Göre Sıralama</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kode+Mono:wght@400..700&family=Madimi+One&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- CSS dosyasını buraya ekliyoruz -->
    <style>
      /* Genel ayarlar */
      body {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        height: 100vh;
        /* Tüm ekran yüksekliğini kapla */
        width: 100vw;
        /* Tüm ekran genişliğini kapla */
        background-color: black;
        /* Arka plan siyah */
        color: white;
        /* Yazılar beyaz */
        font-family: 'Kode Mono', monospace;
        overflow: hidden;
      }

      /* Content ayarları */
      .content {
        display: flex;
        flex-direction: column;
        /* İçeriği dikeyde hizala */
        align-items: center;
        /* İçeriği yatayda ortala */
        justify-content: center;
        /* İçeriği dikeyde ortala */
        width: 100%;
        height: 100%;
      }

      /* Güncelleme yazısı */
      .updatetime {
        text-align: center;
        font-size: 1.2rem;
        /* Yazı boyutu */
      }

      /* Container ayarları */
      .container {
        display: flex;
        flex-wrap: nowrap;
        /* İçerikler her zaman aynı satırda kalacak */
        width: 100%;
        /* Tam genişlik */
        height: auto;
        /* Yükseklik içerik ile orantılı olsun */
        justify-content: center;
        /* Yatayda ortala */
      }

      /* Durak kutuları */
      .durak {
        padding: 1vw 1vh;
        border: 0.2vw solid #ccc;
        border-radius: 2vw;
        text-align: center;
        background-color: #333 !important;
        /* Kutuların arka plan rengi koyu gri */
        box-shadow: 0 1vw 1vw rgba(255, 255, 255, 0);
        color: white;
        /* Yazı rengi beyaz */
        overflow: hidden;
        /* Taşan yazıyı gizle */
        line-height: 1.2;
      }

      /* Dikey düzen (width < height) */
      @media (min-aspect-ratio: 0) and (max-aspect-ratio: 0.499) {
        .content {
          padding-top: 2vw;
        }

        .updatetime {
          font-size: 4vw;
        }

        .container {
          padding-top: 5%;
          flex-direction: column;
          /* Dikey hizalama */
          gap: 2.3vw;
          align-items: center;
          /* İçeriği yatayda ortala */
          margin-bottom: 2%;
        }

        .durak {
          background-color: red;
          width: 50vw;
          /* Dinamik genişlik (viewport genişliğine göre) */
          height: 49vw;
          /* Dinamik yükseklik (viewport yüksekliğine göre) */
          font-size: 3.7vw;
          /* Dinamik yazı boyutu */
        }
      }

      /* Dikey düzen (width < height) */
      @media (min-aspect-ratio: 0.5) and (max-aspect-ratio: 0.799) {
        .content {
          padding-top: 1vw;
        }

        .updatetime {
          font-size: 4vw;
        }

        .container {
          padding-top: 5%;
          flex-direction: column;
          /* Dikey hizalama */
          gap: 2.3vw;
          align-items: center;
          /* İçeriği yatayda ortala */
          margin-bottom: 2%;
        }

        .durak {
          background-color: green;
          width: 50vw;
          /* Dinamik genişlik (viewport genişliğine göre) */
          height: 49vw;
          /* Dinamik yükseklik (viewport yüksekliğine göre) */
          font-size: 2.2vw;
          /* Dinamik yazı boyutu */
        }
      }

      /* Dikey düzen (width < height) */
      @media (min-aspect-ratio: 0.8) and (max-aspect-ratio: 0.99) {
        .content {
          padding-top: 1vw;
        }

        .updatetime {
          font-size: 3vw;
        }

        .container {
          padding-top: 5%;
          flex-direction: column;
          /* Dikey hizalama */
          gap: 2vw;
          align-items: center;
          /* İçeriği yatayda ortala */
          margin-bottom: 2%;
        }

        .durak {
          background-color: cyan;
          width: 30vw;
          /* Dinamik genişlik (viewport genişliğine göre) */
          height: 26vw;
          /* Dinamik yükseklik (viewport yüksekliğine göre) */
          font-size: 1.6vw;
          /* Dinamik yazı boyutu */
        }
      }

      /* Yatay düzen (width > height) */
      @media (min-aspect-ratio: 1) and (max-aspect-ratio: 1.499) {
        .content {
          padding-top: 2%;
        }

        .updatetime {
          font-size: 2.5vw;
        }

        .container {
          flex-direction: row;
          /* Yatay hizalama */
          justify-content: center;
          gap: 5vh;
          /* Öğeler arasında boşluk */
          margin-top: 2%;
          margin-bottom: 5%;
        }

        .durak {
          background-color: brown;
          width: 20vw;
          /* Dinamik genişlik (viewport genişliğine göre) */
          height: 23vw;
          /* Dinamik yükseklik (viewport yüksekliğine göre) */
          font-size: 1.1vw;
          /* Dinamik yazı boyutu */
        }
      }

      @media (min-aspect-ratio: 1.5) and (max-aspect-ratio: 1.899) {
        .content {
          padding-top: 2%;
        }

        .updatetime {
          font-size: 2.5vw;
        }

        .container {
          flex-direction: row;
          /* Yatay hizalama */
          justify-content: center;
          gap: 2vw;
          /* Öğeler arasında boşluk */
          margin-top: 2%;
          margin-bottom: 5%;
        }

        .durak {
          background-color: coral;
          width: 23vw;
          /* Dinamik genişlik (viewport genişliğine göre) */
          height: 20vw;
          /* Dinamik yükseklik (viewport yüksekliğine göre) */
          font-size: 1.3vw;
          /* Dinamik yazı boyutu */
        }
      }

      @media (min-aspect-ratio: 1.9) {
        .content {
          padding-top: 2%;
        }

        .updatetime {
          font-size: 2.7vw;
        }

        .container {
          flex-direction: row;
          /* Yatay hizalama */
          justify-content: center;
          gap: 2vw;
          /* Öğeler arasında boşluk */
          margin-top: 2%;
          margin-bottom: 5%;
        }

        .durak {
          background-color: rgb(188, 23, 230);
          width: 26vw;
          /* Dinamik genişlik (viewport genişliğine göre) */
          height: 27vw;
          /* Dinamik yükseklik (viewport yüksekliğine göre) */
          font-size: 1.7vw;
          /* Dinamik yazı boyutu */
        }
      }
    </style>
    <!-- Firebase SDK'larını ekleyin -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  </head>
  <body>
    <div class="content">
      <!-- Ana İçerik -->
      <div id="main-container">
        <div id="updatetime" class="updatetime"></div>
        <div id="duraklar-container" class="container">
          <!-- Durak bilgileri buraya JavaScript ile eklenecek -->
        </div>
      </div>
    </div>
    <script>
      // Firebase yapılandırma bilgileri
      const firebaseConfig = {
        apiKey: "AIzaSyCTTDvLsIY3ZS8zNP77lxLG0SdoOke2vLk",
        authDomain: "kptakip.firebaseapp.com",
        databaseURL: "https://kptakip-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "kptakip",
        storageBucket: "kptakip.firebasestorage.app",
        messagingSenderId: "401633293269",
        appId: "1:401633293269:web:8386edc126aafe1929435c"
      };
      // Firebase uygulamasını başlat
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
      const ref = database.ref('taksi_verileri');
      // Elemanları seç
      const mainContainer = document.getElementById('main-container');
      const duraklarContainer = document.getElementById('duraklar-container');
      const updateTimeElement = document.getElementById('updatetime');

      function renderData(data) {
        // Güncelleme zamanını ayarla
        updateTimeElement.textContent = `Son Güncelleme: ${data.son_guncelleme}`;
        // Durak bilgilerini işle
        duraklarContainer.innerHTML = '';
        const duraklar = data.duraklar;
        const durak_names = {
          suvari: "Süvari",
          merkez: "Merkez",
          metro: "Metro"
        };
        for (const key in duraklar) {
          if (duraklar.hasOwnProperty(key)) {
            const durak = duraklar[key];
            const durakDiv = document.createElement('div');
            durakDiv.className = 'durak';
            const aracListesi = durak.liste || [];
            const aracSayisi = aracListesi.length;
            let araclarList = '';
            if (aracSayisi > 0) {
              // Araçları istediğiniz formatta listele
              araclarList = aracListesi.map((arac, index) => `
								<br>${index + 1}) ${arac.code} | ${arac.plate} | &nbsp;&nbsp;${arac.entry_duration} dk`).join('');
            } else {
              araclarList = 'Boş';
            }
            // Şablonu tek bir satırda birleştirerek boşlukları giderdik
            durakDiv.innerHTML = `${durak_names[key]} (${aracSayisi})
									<br>Ortalama Kalkış: ${durak.ortalama_kalkis} dk 
										<br>—————————————————————————${araclarList}`;
            duraklarContainer.appendChild(durakDiv);
          }
        }
      }
      // Veritabanı referansındaki veriyi dinle
      ref.on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
          renderData(data);
        } else {
          console.error("Veri alınamadı. Lütfen Python betiğinin çalıştığından emin olun.");
          duraklarContainer.innerHTML = ' < p style = "color:red; text-align:center;" > Veri alınamadı.Lütfen Python betiğinin çalıştığından emin olun. < /p>';
        }
      }, (error) => {
        console.error("Veri okuma hatası: ", error);
        duraklarContainer.innerHTML = ' < p style = "color:red; text-align:center;" > Veri okuma hatası oluştu.Konsolu kontrol edin. < /p>';
      });
    </script>
  </body>
</html>
